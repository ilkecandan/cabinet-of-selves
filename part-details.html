<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Meet Your Part</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="part-details.js"></script>
</head>
<body>

<header class="main-header">
    <h1 id="partTitle">Meet Your Part</h1>
    <p id="pageDescription">This is a gentle place to explore and understand this part of you.</p>
</header>

<!-- Language Selector -->
<div class="language-selector">
    <label for="language">ğŸŒ</label>
    <select id="language" onchange="switchLanguage(this.value)">
        <option value="en">English</option>
        <option value="tr">TÃ¼rkÃ§e</option>
        <option value="de">Deutsch</option>
    </select>
</div>

<!-- Main Section -->
<main class="part-details-box">
    <!-- Image Upload and Preview -->
    <div class="image-container">
        <img id="partImagePreview" src="images/girl.jpg" class="part-image">
        <input type="file" id="partImageInput" accept="image/*">
    </div>

    <!-- Form Grid Layout -->
    <div class="form-container">
        <div class="form-group">
            <label id="labelKnownSince">ğŸŒ± How long have you known this part?</label>
            <input type="text" id="partSince" placeholder="A long time, since childhood, etc.">
        </div>

        <div class="form-group">
            <label id="labelWants">ğŸ’¬ What does this part want for you?</label>
            <textarea id="partWants"></textarea>
        </div>

        <div class="form-group">
            <label id="labelWorksWith">ğŸŒŸ Which parts does this part work well with?</label>
            <input type="text" id="partWorksWith">
        </div>

        <div class="form-group">
            <label id="labelClashesWith">âš”ï¸ Which parts does this part clash with?</label>
            <input type="text" id="partClashesWith">
        </div>

        <div class="form-group">
            <label id="labelRole">ğŸ­ What role does this part play?</label>
            <input type="text" id="partRole">
        </div>
    </div>

    <!-- Buttons -->
    <div class="button-container">
        <button onclick="savePartDetails()" id="saveButton">ğŸ’¾ Save Part Details</button>
        <button onclick="location.href='index.html'" id="backCabinetButton">â¬…ï¸ Back to Cabinet</button>
        <button onclick="location.href='parts.html'" id="backPartsButton">ğŸ“‚ Back to All Parts</button>
    </div>
</main>

<!-- Script Section -->
<script>
    const params = new URLSearchParams(window.location.search);
    const partName = params.get('part');

    // Load part data (including image)
    let part = JSON.parse(localStorage.getItem(`part-${partName}`)) || {};
    let allParts = JSON.parse(localStorage.getItem('innerParts')) || [];

    document.getElementById('partTitle').innerText = `Meet ${partName}`;

    // Pre-fill fields and set image
    document.getElementById('partSince').value = part.knownSince || '';
    document.getElementById('partWants').value = part.wants || '';
    document.getElementById('partWorksWith').value = part.worksWith || '';
    document.getElementById('partClashesWith').value = part.clashesWith || '';
    document.getElementById('partRole').value = part.role || '';
    document.getElementById('partImagePreview').src = part.image || 'images/girl.jpg';

    // Handle image upload and save
    document.getElementById('partImageInput').addEventListener('change', (event) => {
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = () => {
                document.getElementById('partImagePreview').src = reader.result;
                part.image = reader.result;

                savePart(true);
                showNotification('âœ… Image saved successfully!', 'success');
            };
            reader.readAsDataURL(file);
        }
    });

    function savePartDetails() {
        part.knownSince = document.getElementById('partSince').value;
        part.wants = document.getElementById('partWants').value;
        part.worksWith = document.getElementById('partWorksWith').value;
        part.clashesWith = document.getElementById('partClashesWith').value;
        part.role = document.getElementById('partRole').value;

        savePart();
        showNotification('âœ… Part details saved successfully!', 'success');
    }

    function savePart(isImageOnly = false) {
        localStorage.setItem(`part-${partName}`, JSON.stringify(part));

        // Ensure the image updates in parts.html
        const index = allParts.findIndex(p => p.name === partName);
        if (index !== -1) {
            allParts[index].img = part.image;
        } else if (!isImageOnly) {
            allParts.push({ name: partName, img: part.image || 'images/girl.jpg' });
        }

        localStorage.setItem('innerParts', JSON.stringify(allParts));
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.innerText = message;
        notification.style.position = 'fixed';
        notification.style.bottom = '20px';
        notification.style.right = '20px';
        notification.style.padding = '10px 20px';
        notification.style.borderRadius = '8px';
        notification.style.backgroundColor = type === 'success' ? '#4caf50' : '#f44336';
        notification.style.color = 'white';
        notification.style.zIndex = '1000';
        document.body.appendChild(notification);

        setTimeout(() => notification.remove(), 3000);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const lang = localStorage.getItem('language') || 'en';
        document.getElementById('language').value = lang;
        switchLanguage(lang);
    });
</script>

</body>
</html>
